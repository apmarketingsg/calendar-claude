<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Echo Schedule - Voice Calendar Assistant</title>
    <link href="https://fonts.googleapis.com/css2?family=Syne:wght@400;600;700;800&family=DM+Sans:wght@400;500;600&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --bg-dark: #0a0a0f;
            --bg-card: #16161f;
            --accent-primary: #ff6b35;
            --accent-glow: #ff8c5a;
            --text-primary: #ffffff;
            --text-secondary: #a0a0b0;
            --success: #00ff88;
            --warning: #ffd600;
        }

        body {
            font-family: 'DM Sans', sans-serif;
            background: var(--bg-dark);
            color: var(--text-primary);
            min-height: 100vh;
            overflow-x: hidden;
            position: relative;
        }

        /* Animated background */
        body::before {
            content: '';
            position: fixed;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: 
                radial-gradient(circle at 20% 50%, rgba(255, 107, 53, 0.15) 0%, transparent 50%),
                radial-gradient(circle at 80% 80%, rgba(255, 140, 90, 0.1) 0%, transparent 50%);
            animation: backgroundShift 20s ease-in-out infinite;
            pointer-events: none;
        }

        @keyframes backgroundShift {
            0%, 100% { transform: translate(0, 0) rotate(0deg); }
            50% { transform: translate(-5%, -5%) rotate(5deg); }
        }

        .container {
            max-width: 480px;
            margin: 0 auto;
            padding: 20px;
            position: relative;
            z-index: 1;
        }

        header {
            text-align: center;
            padding: 40px 0 30px;
        }

        .logo {
            font-family: 'Syne', sans-serif;
            font-size: 32px;
            font-weight: 800;
            letter-spacing: -0.5px;
            background: linear-gradient(135deg, var(--accent-primary), var(--accent-glow));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 8px;
        }

        .tagline {
            font-size: 14px;
            color: var(--text-secondary);
            font-weight: 500;
        }

        /* Voice Interface */
        .voice-container {
            position: relative;
            padding: 60px 0;
        }

        .mic-button {
            width: 180px;
            height: 180px;
            margin: 0 auto;
            position: relative;
            cursor: pointer;
            transition: transform 0.2s ease;
        }

        .mic-button:active {
            transform: scale(0.95);
        }

        .mic-orb {
            width: 100%;
            height: 100%;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--accent-primary), var(--accent-glow));
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 
                0 0 60px rgba(255, 107, 53, 0.4),
                0 20px 40px rgba(0, 0, 0, 0.3);
            position: relative;
            z-index: 2;
        }

        .mic-orb::before {
            content: '';
            position: absolute;
            inset: -10px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--accent-primary), var(--accent-glow));
            opacity: 0;
            animation: pulse 2s ease-in-out infinite;
            z-index: -1;
        }

        @keyframes pulse {
            0%, 100% { opacity: 0; transform: scale(1); }
            50% { opacity: 0.3; transform: scale(1.15); }
        }

        .mic-icon {
            width: 60px;
            height: 60px;
            fill: white;
        }

        .listening .mic-orb {
            animation: listening 1.5s ease-in-out infinite;
        }

        @keyframes listening {
            0%, 100% { transform: scale(1); box-shadow: 0 0 60px rgba(255, 107, 53, 0.4); }
            50% { transform: scale(1.05); box-shadow: 0 0 80px rgba(255, 107, 53, 0.6); }
        }

        .status-text {
            text-align: center;
            margin-top: 24px;
            font-size: 16px;
            font-weight: 500;
            color: var(--text-secondary);
            min-height: 24px;
        }

        .listening .status-text {
            color: var(--accent-glow);
        }

        /* Transcript Display */
        .transcript {
            background: var(--bg-card);
            border-radius: 16px;
            padding: 20px;
            margin: 20px 0;
            min-height: 80px;
            border: 1px solid rgba(255, 107, 53, 0.1);
            display: none;
        }

        .transcript.active {
            display: block;
            animation: slideIn 0.3s ease;
        }

        @keyframes slideIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .transcript-label {
            font-size: 12px;
            text-transform: uppercase;
            letter-spacing: 1px;
            color: var(--text-secondary);
            margin-bottom: 8px;
        }

        .transcript-text {
            font-size: 16px;
            line-height: 1.6;
            color: var(--text-primary);
        }

        /* Response */
        .response {
            background: linear-gradient(135deg, var(--bg-card), rgba(255, 107, 53, 0.05));
            border-radius: 16px;
            padding: 20px;
            margin: 20px 0;
            border: 1px solid rgba(255, 107, 53, 0.2);
            display: none;
        }

        .response.active {
            display: block;
            animation: slideIn 0.3s ease;
        }

        .response-text {
            font-size: 16px;
            line-height: 1.6;
            margin-bottom: 16px;
        }

        /* Notify Button */
        .notify-btn {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 12px 24px;
            background: var(--accent-primary);
            color: white;
            border: none;
            border-radius: 12px;
            font-weight: 600;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .notify-btn:hover {
            background: var(--accent-glow);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(255, 107, 53, 0.3);
        }

        /* Meetings List */
        .meetings-section {
            margin-top: 40px;
        }

        .section-title {
            font-family: 'Syne', sans-serif;
            font-size: 20px;
            font-weight: 700;
            margin-bottom: 16px;
            color: var(--text-primary);
        }

        .meeting-card {
            background: var(--bg-card);
            border-radius: 16px;
            padding: 20px;
            margin-bottom: 12px;
            border: 1px solid rgba(255, 255, 255, 0.05);
            position: relative;
            overflow: hidden;
        }

        .meeting-card::before {
            content: '';
            position: absolute;
            left: 0;
            top: 0;
            bottom: 0;
            width: 4px;
            background: var(--accent-primary);
        }

        .meeting-time {
            font-size: 14px;
            font-weight: 600;
            color: var(--accent-glow);
            margin-bottom: 6px;
        }

        .meeting-title {
            font-size: 16px;
            font-weight: 600;
            margin-bottom: 4px;
        }

        .meeting-participant {
            font-size: 14px;
            color: var(--text-secondary);
        }

        /* Settings Panel */
        .settings-toggle {
            position: fixed;
            top: 20px;
            right: 20px;
            width: 44px;
            height: 44px;
            background: var(--bg-card);
            border-radius: 12px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 100;
        }

        .settings-panel {
            position: fixed;
            top: 0;
            right: -100%;
            width: 100%;
            max-width: 400px;
            height: 100vh;
            background: var(--bg-card);
            padding: 30px;
            transition: right 0.3s ease;
            z-index: 101;
            overflow-y: auto;
            border-left: 1px solid rgba(255, 255, 255, 0.1);
        }

        .settings-panel.active {
            right: 0;
        }

        .settings-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
        }

        .settings-title {
            font-family: 'Syne', sans-serif;
            font-size: 24px;
            font-weight: 700;
        }

        .close-settings {
            width: 32px;
            height: 32px;
            border: none;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            cursor: pointer;
            font-size: 20px;
            color: var(--text-primary);
        }

        .setting-group {
            margin-bottom: 24px;
        }

        .setting-label {
            font-size: 14px;
            font-weight: 600;
            margin-bottom: 8px;
            display: block;
        }

        .setting-input {
            width: 100%;
            padding: 12px;
            background: var(--bg-dark);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            color: var(--text-primary);
            font-size: 14px;
        }

        .setting-input:focus {
            outline: none;
            border-color: var(--accent-primary);
        }

        .save-settings {
            width: 100%;
            padding: 14px;
            background: var(--accent-primary);
            color: white;
            border: none;
            border-radius: 12px;
            font-weight: 600;
            font-size: 16px;
            cursor: pointer;
            margin-top: 20px;
        }

        .status-indicator {
            display: inline-block;
            width: 8px;
            height: 8px;
            border-radius: 50%;
            margin-left: 8px;
        }

        .status-indicator.connected {
            background: var(--success);
            box-shadow: 0 0 8px var(--success);
        }

        .status-indicator.disconnected {
            background: #ff4444;
            box-shadow: 0 0 8px #ff4444;
        }

        .help-text {
            font-size: 12px;
            color: var(--text-secondary);
            margin-top: 6px;
            line-height: 1.4;
        }

        .empty-state {
            text-align: center;
            padding: 40px 20px;
            color: var(--text-secondary);
        }

        @media (max-width: 480px) {
            .container {
                padding: 16px;
            }
            
            .mic-button {
                width: 160px;
                height: 160px;
            }
            
            .settings-panel {
                max-width: 100%;
            }
        }
    </style>
</head>
<body>
    <div class="settings-toggle" onclick="toggleSettings()">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <circle cx="12" cy="12" r="3"/>
            <path d="M12 1v6m0 6v6m-8-8h6m2 0h6"/>
        </svg>
    </div>

    <div class="container">
        <header>
            <div class="logo">Echo Schedule</div>
            <div class="tagline">Your voice-powered calendar assistant</div>
        </header>

        <div class="voice-container">
            <div class="mic-button" onclick="toggleListening()" id="micButton">
                <div class="mic-orb">
                    <svg class="mic-icon" viewBox="0 0 24 24" fill="currentColor">
                        <path d="M12 14c1.66 0 3-1.34 3-3V5c0-1.66-1.34-3-3-3S9 3.34 9 5v6c0 1.66 1.34 3 3 3z"/>
                        <path d="M17 11c0 2.76-2.24 5-5 5s-5-2.24-5-5H5c0 3.53 2.61 6.43 6 6.92V21h2v-3.08c3.39-.49 6-3.39 6-6.92h-2z"/>
                    </svg>
                </div>
            </div>
            <div class="status-text" id="statusText">Tap to speak</div>
        </div>

        <div class="transcript" id="transcript">
            <div class="transcript-label">You said</div>
            <div class="transcript-text" id="transcriptText"></div>
        </div>

        <div class="response" id="response">
            <div class="response-text" id="responseText"></div>
            <div id="notifyContainer"></div>
        </div>

        <div class="meetings-section">
            <div class="section-title">Today's Meetings</div>
            <div id="meetingsList">
                <div class="empty-state">No meetings scheduled for today</div>
            </div>
        </div>
    </div>

    <!-- Settings Panel -->
    <div class="settings-panel" id="settingsPanel">
        <div class="settings-header">
            <div class="settings-title">Settings</div>
            <button class="close-settings" onclick="toggleSettings()">Ã—</button>
        </div>

        <div class="setting-group">
            <label class="setting-label">
                Google Calendar
                <span class="status-indicator" id="calendarStatus"></span>
            </label>
            <button class="notify-btn" onclick="connectGoogleCalendar()">
                Connect Calendar
            </button>
            <div class="help-text">Connect your Google Calendar to manage meetings</div>
        </div>

        <div class="setting-group">
            <label class="setting-label">
                Twilio Account
                <span class="status-indicator" id="twilioStatus"></span>
            </label>
            <input type="text" class="setting-input" id="twilioAccountSid" placeholder="Account SID">
            <input type="password" class="setting-input" id="twilioAuthToken" placeholder="Auth Token" style="margin-top: 8px;">
            <input type="text" class="setting-input" id="twilioPhoneNumber" placeholder="Singapore Number (e.g., +6512345678)" style="margin-top: 8px;">
            <div class="help-text">Your Twilio credentials for phone call reminders</div>
        </div>

        <div class="setting-group">
            <label class="setting-label">Your Phone Number</label>
            <input type="tel" class="setting-input" id="userPhoneNumber" placeholder="+6598765432">
            <div class="help-text">The number where you'll receive reminder calls</div>
        </div>

        <div class="setting-group">
            <label class="setting-label">Reminder Time</label>
            <select class="setting-input" id="reminderTime">
                <option value="45">45 minutes before</option>
                <option value="30">30 minutes before</option>
                <option value="60">60 minutes before</option>
                <option value="15">15 minutes before</option>
            </select>
        </div>

        <button class="save-settings" onclick="saveSettings()">Save Settings</button>
    </div>

    <script>
        // Speech Recognition
        const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
        const recognition = SpeechRecognition ? new SpeechRecognition() : null;
        const synth = window.speechSynthesis;

        let isListening = false;
        let settings = {
            twilioAccountSid: '',
            twilioAuthToken: '',
            twilioPhoneNumber: '',
            userPhoneNumber: '',
            reminderTime: 45,
            googleCalendarToken: null
        };

        // Load settings from localStorage
        function loadSettings() {
            const saved = localStorage.getItem('echoScheduleSettings');
            if (saved) {
                settings = { ...settings, ...JSON.parse(saved) };
                document.getElementById('twilioAccountSid').value = settings.twilioAccountSid || '';
                document.getElementById('twilioAuthToken').value = settings.twilioAuthToken || '';
                document.getElementById('twilioPhoneNumber').value = settings.twilioPhoneNumber || '';
                document.getElementById('userPhoneNumber').value = settings.userPhoneNumber || '';
                document.getElementById('reminderTime').value = settings.reminderTime || 45;
                updateStatusIndicators();
            }
        }

        function saveSettings() {
            settings.twilioAccountSid = document.getElementById('twilioAccountSid').value;
            settings.twilioAuthToken = document.getElementById('twilioAuthToken').value;
            settings.twilioPhoneNumber = document.getElementById('twilioPhoneNumber').value;
            settings.userPhoneNumber = document.getElementById('userPhoneNumber').value;
            settings.reminderTime = parseInt(document.getElementById('reminderTime').value);
            
            localStorage.setItem('echoScheduleSettings', JSON.stringify(settings));
            updateStatusIndicators();
            speak('Settings saved successfully');
            toggleSettings();
        }

        function updateStatusIndicators() {
            const twilioConnected = settings.twilioAccountSid && settings.twilioAuthToken && settings.twilioPhoneNumber;
            const calendarConnected = settings.googleCalendarToken;
            
            document.getElementById('twilioStatus').className = 'status-indicator ' + (twilioConnected ? 'connected' : 'disconnected');
            document.getElementById('calendarStatus').className = 'status-indicator ' + (calendarConnected ? 'connected' : 'disconnected');
        }

        function toggleSettings() {
            const panel = document.getElementById('settingsPanel');
            panel.classList.toggle('active');
        }

        // Speech Recognition Setup
        if (recognition) {
            recognition.continuous = false;
            recognition.interimResults = false;
            recognition.lang = 'en-SG';

            recognition.onstart = () => {
                document.getElementById('micButton').classList.add('listening');
                document.getElementById('statusText').textContent = 'Listening...';
            };

            recognition.onresult = (event) => {
                const transcript = event.results[0][0].transcript;
                document.getElementById('transcriptText').textContent = transcript;
                document.getElementById('transcript').classList.add('active');
                processVoiceCommand(transcript);
            };

            recognition.onerror = (event) => {
                console.error('Speech recognition error:', event.error);
                document.getElementById('statusText').textContent = 'Error. Tap to try again';
                isListening = false;
                document.getElementById('micButton').classList.remove('listening');
            };

            recognition.onend = () => {
                isListening = false;
                document.getElementById('micButton').classList.remove('listening');
                document.getElementById('statusText').textContent = 'Tap to speak';
            };
        }

        function toggleListening() {
            if (!recognition) {
                alert('Speech recognition not supported in this browser. Please use Chrome or Edge.');
                return;
            }

            if (isListening) {
                recognition.stop();
            } else {
                isListening = true;
                recognition.start();
            }
        }

        function speak(text) {
            const utterance = new SpeechSynthesisUtterance(text);
            utterance.lang = 'en-SG';
            utterance.rate = 1.0;
            synth.speak(utterance);
        }

        // Process voice commands
        async function processVoiceCommand(command) {
            const lowerCommand = command.toLowerCase();
            
            // Extract meeting details using simple pattern matching
            let response = '';
            let action = null;

            if (lowerCommand.includes('schedule') || lowerCommand.includes('set up') || lowerCommand.includes('create')) {
                action = 'create';
                response = await handleCreateMeeting(command);
            } else if (lowerCommand.includes('reschedule') || lowerCommand.includes('move')) {
                action = 'reschedule';
                response = await handleRescheduleMeeting(command);
            } else if (lowerCommand.includes('cancel') || lowerCommand.includes('delete')) {
                action = 'cancel';
                response = await handleCancelMeeting(command);
            } else if (lowerCommand.includes('what') || lowerCommand.includes('show') || lowerCommand.includes('list')) {
                action = 'list';
                response = await handleListMeetings(command);
            } else {
                response = "I didn't quite catch that. You can ask me to schedule, reschedule, cancel, or list meetings.";
            }

            displayResponse(response, action);
            speak(response);
        }

        async function handleCreateMeeting(command) {
            // Parse meeting details (simplified - in production use NLP)
            const meeting = parseMeetingFromCommand(command);
            
            if (!settings.googleCalendarToken) {
                return "Please connect your Google Calendar in settings first.";
            }

            // Create meeting in Google Calendar
            try {
                await createGoogleCalendarEvent(meeting);
                
                // Schedule reminder call
                if (settings.twilioAccountSid && settings.userPhoneNumber) {
                    await scheduleReminderCall(meeting);
                }

                return `Meeting scheduled with ${meeting.participant} for ${meeting.time}. I'll call you 45 minutes before.`;
            } catch (error) {
                return "I had trouble creating the meeting. Please check your calendar connection.";
            }
        }

        async function handleRescheduleMeeting(command) {
            return "I can help you reschedule. Which meeting would you like to move?";
        }

        async function handleCancelMeeting(command) {
            const meeting = parseMeetingFromCommand(command);
            return `Meeting with ${meeting.participant} cancelled. Would you like to notify them?`;
        }

        async function handleListMeetings(command) {
            await loadTodaysMeetings();
            return "Here are your meetings for today.";
        }

        function parseMeetingFromCommand(command) {
            // Simplified parsing - in production, use proper NLP or AI
            return {
                participant: extractParticipant(command),
                time: extractTime(command),
                title: extractTitle(command),
                date: extractDate(command)
            };
        }

        function extractParticipant(command) {
            const withMatch = command.match(/with\s+(\w+)/i);
            return withMatch ? withMatch[1] : 'Unknown';
        }

        function extractTime(command) {
            const timeMatch = command.match(/(\d+)\s*(am|pm)/i);
            if (timeMatch) return `${timeMatch[1]}${timeMatch[2]}`;
            return 'Not specified';
        }

        function extractTitle(command) {
            return command.substring(0, 50);
        }

        function extractDate(command) {
            if (command.includes('tomorrow')) {
                const tomorrow = new Date();
                tomorrow.setDate(tomorrow.getDate() + 1);
                return tomorrow.toISOString();
            }
            return new Date().toISOString();
        }

        function displayResponse(text, action) {
            const responseEl = document.getElementById('response');
            const responseText = document.getElementById('responseText');
            const notifyContainer = document.getElementById('notifyContainer');
            
            responseText.textContent = text;
            responseEl.classList.add('active');

            // Show notify buttons for actions affecting others
            if (action === 'cancel' || action === 'reschedule' || action === 'create') {
                notifyContainer.innerHTML = `
                    <button class="notify-btn" onclick="notifyViaWhatsApp()">
                        ðŸ“± Notify via WhatsApp
                    </button>
                    <button class="notify-btn" onclick="notifyViaSMS()" style="margin-left: 8px;">
                        ðŸ’¬ Notify via SMS
                    </button>
                `;
            } else {
                notifyContainer.innerHTML = '';
            }
        }

        function notifyViaWhatsApp() {
            const message = encodeURIComponent(document.getElementById('responseText').textContent);
            const phoneNumber = ''; // This would be extracted from meeting participant
            window.open(`https://wa.me/${phoneNumber}?text=${message}`, '_blank');
        }

        function notifyViaSMS() {
            const message = encodeURIComponent(document.getElementById('responseText').textContent);
            const phoneNumber = ''; // This would be extracted from meeting participant
            window.open(`sms:${phoneNumber}?body=${message}`, '_blank');
        }

        // Google Calendar Integration
        async function connectGoogleCalendar() {
            // This requires backend OAuth flow
            alert('Google Calendar connection requires backend setup. Please see implementation guide.');
            // In production, this would redirect to OAuth consent screen
        }

        async function createGoogleCalendarEvent(meeting) {
            // Placeholder - requires actual Google Calendar API implementation
            console.log('Creating calendar event:', meeting);
            return true;
        }

        async function loadTodaysMeetings() {
            // Placeholder - load from Google Calendar API
            const sampleMeetings = [
                {
                    time: '10:00 AM',
                    title: 'Team Standup',
                    participant: 'Engineering Team'
                },
                {
                    time: '2:30 PM',
                    title: 'Client Review',
                    participant: 'John Tan'
                }
            ];

            displayMeetings(sampleMeetings);
        }

        function displayMeetings(meetings) {
            const container = document.getElementById('meetingsList');
            
            if (meetings.length === 0) {
                container.innerHTML = '<div class="empty-state">No meetings scheduled for today</div>';
                return;
            }

            container.innerHTML = meetings.map(meeting => `
                <div class="meeting-card">
                    <div class="meeting-time">${meeting.time}</div>
                    <div class="meeting-title">${meeting.title}</div>
                    <div class="meeting-participant">with ${meeting.participant}</div>
                </div>
            `).join('');
        }

        // Twilio Integration
        async function scheduleReminderCall(meeting) {
            if (!settings.twilioAccountSid || !settings.twilioAuthToken) {
                console.log('Twilio not configured');
                return;
            }

            // Calculate reminder time
            const meetingTime = new Date(meeting.date);
            const reminderTime = new Date(meetingTime.getTime() - settings.reminderTime * 60000);
            
            // In production, this would be handled by a backend scheduler
            console.log('Reminder call scheduled for:', reminderTime);
            
            // Twilio API call would look like this:
            /*
            const response = await fetch('https://api.twilio.com/2010-04-01/Accounts/{AccountSid}/Calls.json', {
                method: 'POST',
                headers: {
                    'Authorization': 'Basic ' + btoa(settings.twilioAccountSid + ':' + settings.twilioAuthToken),
                    'Content-Type': 'application/x-www-form-urlencoded'
                },
                body: new URLSearchParams({
                    From: settings.twilioPhoneNumber,
                    To: settings.userPhoneNumber,
                    Url: 'https://your-backend.com/reminder-call-twiml/' + meeting.id,
                    Method: 'GET'
                })
            });
            */
        }

        // Initialize
        loadSettings();
        loadTodaysMeetings();
        updateStatusIndicators();
    </script>
</body>
</html>
